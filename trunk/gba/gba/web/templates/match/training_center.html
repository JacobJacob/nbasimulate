{% load common_extras %}
<script type="text/javascript" src="/site_media/js/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/site_media/js/rpc.js"></script>
<script type="text/javascript" src="/site_media/js/jquery/ui/ui.core.js"></script>
<script type="text/javascript" src="/site_media/js/jquery/ui/ui.dialog.js"></script>
<link rel="stylesheet" href="/site_media/js/jquery/ui/themes/flora/flora.all.css" type="text/css" media="screen" title="no title" />
<link href="/site_media/css/skin.css" rel="stylesheet" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf8" />
<script type="text/javascript">
     
  service = new rpc.ServiceProxy("/services/match/", {asynchronous:false, methods: ['apply_training_center']});
  $(document).ready(function(){
    
	 $('a.player_name').click(function() {
	     var id = $(this).parent().parent().attr('no');
	     $.ajax({
		    url: '{% url freeplayer-detail %}?no=' + id,
		    type: 'get',
		    datatype: 'html',
		    timeout: 1000,
		    error: function(error){
		        alert(error.message);
		    },
		    success: function(html){
		        $('#play_detail').html(html);
		    }
		});
	 });
	 
	 $('a.auction').click(function() {
	     var no = $(this).parent().parent().attr('no');
	     try{
	         var data = service.get_free_auction_info(no);
	         var result = data[0];
	         if(result==-1){
	            alert('该球员已经截止!');
	            return;
	         }else if(result == -2){
	            alert('您已经出过价了,不允许重复出价!');
	            return;
	         }
	     }catch(error){
	         alert('出现未知异常!,请重试');
	     }
	     $("#no").val(no);
	     $("#min_price").html(data[1]);
	     $("#free_funds").html(data[2]);
	     $("#auction_player_dialog").show().dialog({
	         height: 180, width: 300, modal: false,
             title: '自由球员竞拍',
	         overlay: {
               opacity: 0.5, 
               background: "black" 
             }
         });
         $("#auction_player_dialog").dialog('open');
	 });
	 
	 $('a.attention').click(function() {
	     var no = $(this).parent().parent().attr('no');
	     try{
	         var result = service.attention_player(no, 1);
	         if(result == 1){
	            alert('关注成功!您可以在我的关注列表中查看该球员');
	            return;
	         }else if(result == 2){
	            alert('您已经关注过该球员了!');
	            return;
	         }else if(result == 3){
	            alert('最多只可以关注10个球员!');
	            return;
	         }else{
	            alert('出现未知异常,请重试');
	         }
	     }catch(error){
	         alert(error);
	     }
	 });
	 
	  
	 $('#apply').click(function(){
	     try{
	         var ret_val = service.apply_training_center()
	         if(ret_val==-1){
	            alert('您已经在训练中心了');
	         }else if(ret_val==1){
	            alert('报名成功');
	         }
	     }catch(error){
	        alert(error);
	     }
     });
});
  
</script>
<style type="text/css">
<!--
body {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
	background-color: #eef2fb;
}
-->
</style>
<body>
<div id="left">
<table width="100%" border=0 cellpadding=0 cellspacing=0 id=sectable>
    <tbody>
      <tr align=middle height=20>
        <td align="center" width="90px" class="{% ifequal tab 1 %}sec2{% else %}sec1{% endifequal %}"><a href="{% url free-players %}?position=c">青年训练<a></td>
        <td align="center" width="90px" class="{% ifequal tab 2 %}sec2{% else %}sec1{% endifequal %}"><a href="{% url free-players %}?position=pf">我的约战<a></td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
</table>
<div id="left-main">
<table width="100%" border=0 cellpadding=0 cellspacing=0 class="normal_table">
  <thead>
    <th width="80px" class="align_center">等级</th>
    <th class="align_left">球队</th>
    <th width="80px">状态</th>
    <th width="80px">操作</th>
  </thead>
  <tbody>
    {% if in_match %}
       <tr no="{{ training_center.no }}">
        <td class="left align_center"><a class="player_name">[{{ training_center.team_id|team_youth_level }}]</a></td>
        <td>{{ training_center.team_id|team_name }}</td>
        <td class="align_center">
          {% ifequal training_center.in_match 1%}
             比赛中
          {% else %}
             等待中
          {% endifequal %}
        </td>
        <td class="align_center"><a>退出训练</a></td>
       </tr>
    {% endif %}
    {% if infos %}
      {% for info in infos %}
       <tr no="{{ info.no }}">
        <td class="left name"><a class="player_name">{{ info.name }}</a></td>
        <td class="number">{{ info.age }}</td>
        <td class="number">{{ info.stature }}</td>
        <td class="right align_center"></td>
       </tr>
      {% endfor %}
      <tr>
        <td colspan="4" class="right">
          共{{page}}/{{totalpage}}页
          {% ifequal page 1 %}
            首页
            上一页
          {% else %}
             <a href="{% url free-players %}?page=1&position={{position}}&order={{order}}&order_by={{order_by}}">首页</a>
             <a href="{% url free-players %}?page={{prevpage}}&position={{position}}&order={{order}}&order_by={{order_by}}">上一页</a>
          {% endifequal %}
          {% ifequal page totalpage %}
            末页
            下一页
          {% else %}
             <a href="{% url free-players %}?page={{totalpage}}&position={{position}}&order={{order}}&order_by={{order_by}}">末页</a>
             <a href="{% url free-players %}?page={{nextpage}}&position={{position}}&order={{order}}&order_by={{order_by}}">下一页</a>
          {% endifequal %}
        </td>
      </tr>
    {% endif %}
    {% ifequal in_match 0 %}
          <tr>
            <td colspan="4"><input type="button" id="apply" value="我要报名"/></td>
          </tr>
    {% endifequal %}
  </tbody>
</table>
</div>
</div>
<div id="side"><span id="play_detail" ></span></div>
</body>